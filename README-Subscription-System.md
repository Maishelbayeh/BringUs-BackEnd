# ูุธุงู ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช - Subscription Management System

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงุดุชุฑุงูุงุช ุงููุชุงุฌุฑ ูู ููุตุฉ BringUs. ุงููุธุงู ูุชุถูู:

1. **ูุชุฑุฉ ุชุฌุฑูุจูุฉ ูุฌุงููุฉ**: 14 ููู ููู ูุชุฌุฑ ุฌุฏูุฏ
2. **ุฎุทุท ุงุดุชุฑุงู ูุฑูุฉ**: ุดูุฑุ 3 ุฃุดูุฑุ 6 ุฃุดูุฑุ ุณูุฉ
3. **ูุญุต ุชููุงุฆู ูููู**: ูู ููู ุงูุณุงุนุฉ 12 ุธูุฑุงู
4. **ุฅุฏุงุฑุฉ ุดุงููุฉ**: ุชูุนููุ ุฅูุบุงุกุ ุชูุฏูุฏุ ูุฑุงูุจุฉ

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### ๐ ูุญุต ุชููุงุฆู ูููู
- ูุนูู ูู ููู ุงูุณุงุนุฉ 12:00 ุธูุฑุงู
- ููุญุต ุฌููุน ุงููุชุงุฌุฑ ุชููุงุฆูุงู
- ูุญูู ุงููุชุงุฌุฑ ุงูููุชููุฉ ุตูุงุญูุชูุง ุฅูู `inactive`
- ูุฑุณู ุชูุจููุงุช ูููุชุงุฌุฑ ุงูุชู ุชูุชูู ุตูุงุญูุชูุง ูุฑูุจุงู

### ๐ ุฅุญุตุงุฆูุงุช ุดุงููุฉ
- ุฅุฌูุงูู ุงููุชุงุฌุฑ ุงููุดุทุฉ/ุบูุฑ ุงููุดุทุฉ
- ุนุฏุฏ ุงููุดุชุฑููู ููุงุจู ุงูุชุฌุฑูุจููู
- ุงููุชุงุฌุฑ ุงูุชู ุชูุชูู ุตูุงุญูุชูุง ุงูููู/ูุฐุง ุงูุฃุณุจูุน

### ๐ฏ ุฅุฏุงุฑุฉ ูุฑูุฉ
- ุชูุนูู ุงุดุชุฑุงูุงุช ุจุฃู ูุฏุฉ
- ุชูุฏูุฏ ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ
- ุฅูุบุงุก ููุฑู ุฃู ูู ููุงูุฉ ุงููุชุฑุฉ
- ูุฑุงูุจุฉ ุญุงูุฉ ูู ูุชุฌุฑ

## ูููู ุงูุจูุงูุงุช

### ูููุฐุฌ Store ุงููุญุฏุซ
```javascript
subscription: {
  isSubscribed: Boolean,        // ูู ูุดุชุฑู ุฃู ูุง
  plan: String,                 // ููุน ุงูุฎุทุฉ (free, monthly, quarterly, semi_annual, annual)
  startDate: Date,              // ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุงุดุชุฑุงู
  endDate: Date,                // ุชุงุฑูุฎ ุงูุชูุงุก ุงูุงุดุชุฑุงู
  lastPaymentDate: Date,        // ุชุงุฑูุฎ ุขุฎุฑ ุฏูุน
  nextPaymentDate: Date,        // ุชุงุฑูุฎ ุงูุฏูุน ุงููุงุฏู
  trialEndDate: Date,           // ุชุงุฑูุฎ ุงูุชูุงุก ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ
  autoRenew: Boolean,           // ุชุฌุฏูุฏ ุชููุงุฆู
  paymentMethod: String,        // ุทุฑููุฉ ุงูุฏูุน
  amount: Number,               // ูุจูุบ ุงูุงุดุชุฑุงู
  currency: String              // ุงูุนููุฉ
}
```

### Virtual Properties
```javascript
isSubscriptionActive    // ูู ุงูุงุดุชุฑุงู ูุดุท
isTrialExpired         // ูู ุงูุชูุช ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ
daysUntilTrialExpires  // ุฃูุงู ุญุชู ุงูุชูุงุก ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ
daysUntilSubscriptionExpires // ุฃูุงู ุญุชู ุงูุชูุงุก ุงูุงุดุชุฑุงู
```

## API Endpoints

### ๐ ุงูุฅุญุตุงุฆูุงุช
```
GET /api/subscription/stats
```
ูุญุตู ุนูู ุฅุญุตุงุฆูุงุช ุดุงููุฉ ูุฌููุน ุงูุงุดุชุฑุงูุงุช

### ๐ ูุญุต ูุชุฌุฑ ูุญุฏุฏ
```
GET /api/subscription/check/{storeId}
```
ููุญุต ุญุงูุฉ ุงุดุชุฑุงู ูุชุฌุฑ ูุญุฏุฏ

### โก ุชุดุบูู ูุญุต ูุฏูู
```
POST /api/subscription/trigger-check
```
ุชุดุบูู ูุญุต ุงูุงุดุชุฑุงูุงุช ูุฏููุงู (ููุณูุจุฑุงุฏูู ููุท)

### โ ุชูุนูู ุงุดุชุฑุงู
```
POST /api/subscription/activate/{storeId}
```
ุชูุนูู ุฃู ุชุฌุฏูุฏ ุงุดุชุฑุงู ููุชุฌุฑ

### โฐ ุชูุฏูุฏ ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ
```
POST /api/subscription/extend-trial/{storeId}
```
ุชูุฏูุฏ ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ ููุชุฌุฑ

### ๐ ุงููุชุงุฌุฑ ุงูููุชููุฉ ุตูุงุญูุชูุง ูุฑูุจุงู
```
GET /api/subscription/expiring?days=7
```
ูุงุฆูุฉ ุงููุชุงุฌุฑ ุงูุชู ุชูุชูู ุตูุงุญูุชูุง ุฎูุงู ุฃูุงู ูุญุฏุฏุฉ

### ๐ซ ุงููุชุงุฌุฑ ุงูููุบูุฉ
```
GET /api/subscription/deactivated?days=30
```
ูุงุฆูุฉ ุงููุชุงุฌุฑ ุงูููุบูุฉ ุฎูุงู ูุชุฑุฉ ูุญุฏุฏุฉ

### โ ุฅูุบุงุก ุงุดุชุฑุงู
```
POST /api/subscription/cancel/{storeId}
```
ุฅูุบุงุก ุงุดุชุฑุงู ูุชุฌุฑ

## ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ุชูุนูู ุงุดุชุฑุงู ุดูุฑู
```javascript
const response = await fetch('/api/subscription/activate/507f1f77bcf86cd799439011', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_TOKEN'
  },
  body: JSON.stringify({
    plan: 'monthly',
    durationInDays: 30,
    amount: 99.99,
    paymentMethod: 'credit_card',
    autoRenew: true
  })
});
```

### ุชูุฏูุฏ ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ
```javascript
const response = await fetch('/api/subscription/extend-trial/507f1f77bcf86cd799439011', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_TOKEN'
  },
  body: JSON.stringify({
    daysToAdd: 7
  })
});
```

### ุงูุญุตูู ุนูู ุงูุฅุญุตุงุฆูุงุช
```javascript
const response = await fetch('/api/subscription/stats', {
  headers: {
    'Authorization': 'Bearer YOUR_TOKEN'
  }
});

const stats = await response.json();
console.log('ุฅุฌูุงูู ุงููุชุงุฌุฑ:', stats.data.total);
console.log('ุงููุดุชุฑููู:', stats.data.subscribed);
console.log('ุงูุชุฌุฑูุจููู:', stats.data.trial);
```

## ุฎุทุท ุงูุงุดุชุฑุงู ุงููุชุงุญุฉ

| ุงูุฎุทุฉ | ุงููุฏุฉ | ุงููุตู |
|-------|-------|-------|
| `free` | 14 ููู | ูุชุฑุฉ ุชุฌุฑูุจูุฉ ูุฌุงููุฉ |
| `monthly` | 30 ููู | ุงุดุชุฑุงู ุดูุฑู |
| `quarterly` | 90 ููู | ุงุดุชุฑุงู ุฑุจุน ุณููู |
| `semi_annual` | 180 ููู | ุงุดุชุฑุงู ูุตู ุณููู |
| `annual` | 365 ููู | ุงุดุชุฑุงู ุณููู |

## ุขููุฉ ุงูุนูู

### 1. ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ
- ูุญุตู ุชููุงุฆูุงู ุนูู ูุชุฑุฉ ุชุฌุฑูุจูุฉ 30 ููู
- `isSubscribed: false`
- `trialEndDate: createdAt + 30 days`

### 2. ุงููุญุต ุงููููู (12:00 ุธูุฑุงู)
- ููุญุต ุฌููุน ุงููุชุงุฌุฑ
- ูุชุญูู ูู `trialEndDate` ู `endDate`
- ูุญูู ุงููุชุงุฌุฑ ุงูููุชููุฉ ุฅูู `inactive`
- ูุฑุณู ุชูุจููุงุช ูููุชุงุฌุฑ ุงูุชู ุชูุชูู ูุฑูุจุงู

### 3. ุชูุนูู ุงุดุชุฑุงู
- ูุญุฏุซ `isSubscribed: true`
- ูุญุฏุฏ `plan`, `startDate`, `endDate`
- ูุญุฏุซ `status: active`

### 4. ุฅูุบุงุก ุงุดุชุฑุงู
- `immediate: true` - ุฅูุบุงุก ููุฑู
- `immediate: false` - ุฅูุบุงุก ูู ููุงูุฉ ุงููุชุฑุฉ

## ุงูุชูุจููุงุช ูุงูุฅุดุนุงุฑุงุช

ุงููุธุงู ูุฑุณู ุชูุจููุงุช ูู ุงูุญุงูุงุช ุงูุชุงููุฉ:
- **3 ุฃูุงู ูุจู ุงูุชูุงุก ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ**
- **3 ุฃูุงู ูุจู ุงูุชูุงุก ุงูุงุดุชุฑุงู**
- **ููู ุงูุชูุงุก ุงูุงุดุชุฑุงู/ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ**
- **ุจุนุฏ ุฅูุบุงุก ุงูุงุดุชุฑุงู**

## ุงูุฃูุงู ูุงูุตูุงุญูุงุช

- ุฌููุน endpoints ุชุชุทูุจ ูุตุงุฏูุฉ
- ูุนุธู ุงูุนูููุงุช ุชุชุทูุจ ุตูุงุญูุงุช ุณูุจุฑุงุฏูู
- ูุญุต ุชููุงุฆู ูููุน ุงูุชูุงุนุจ ุจุงูุชูุงุฑูุฎ

## ุงููุฑุงูุจุฉ ูุงูุชุชุจุน

### ุณุฌูุงุช ุงููุธุงู
```
๐ Starting daily subscription status check...
๐ Found 5 stores to deactivate
๐ด Deactivated store: Electronics Store (507f1f77bcf86cd799439011)
โ๏ธ Store expiring soon: Fashion Store - 3 days left
๐ Subscription check completed:
   โ Total stores checked: 150
   ๐ด Stores deactivated: 5
   โ๏ธ Warnings generated: 12
   โ Errors encountered: 0
```

### ูุคุดุฑุงุช ุงูุฃุฏุงุก
- ุนุฏุฏ ุงููุชุงุฌุฑ ุงููุดุทุฉ
- ูุนุฏู ุงูุชุญููู ูู ุชุฌุฑูุจู ุฅูู ูุดุชุฑู
- ูุนุฏู ุงูุฅูุบุงุก
- ุงูุฅูุฑุงุฏุงุช ุงูุดูุฑูุฉ

## ุงูุชุทููุฑ ุงููุณุชูุจูู

### ููุฒุงุช ููุชุฑุญุฉ
1. **ูุธุงู ุฏูุน ูุชูุงูู** - Stripe, PayPal
2. **ุฎุทุท ุงุดุชุฑุงู ูุฎุตุตุฉ** - ุญุณุจ ุนุฏุฏ ุงูููุชุฌุงุช/ุงูุทูุจุงุช
3. **ุฎุตููุงุช ูุญููุงุช** - ููุจููุงุชุ ุนุฑูุถ ุฎุงุตุฉ
4. **ุชูุงุฑูุฑ ูุชูุฏูุฉ** - ุชุญูููุงุช ููุตูุฉ
5. **ุฅุดุนุงุฑุงุช ูุชุนุฏุฏุฉ** - Email, SMS, Push notifications

### ุชุญุณููุงุช ุชูููุฉ
1. **Queue System** - ููุนุงูุฌุฉ ุงููุญูุตุงุช ุงููุจูุฑุฉ
2. **Caching** - ูุชุณุฑูุน ุงูุงุณุชุนูุงูุงุช
3. **Webhooks** - ูุฅุดุนุงุฑุงุช ููุฑูุฉ
4. **Audit Logs** - ูุชุชุจุน ุฌููุน ุงูุชุบููุฑุงุช

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ
1. **ุงููุชุฌุฑ ูุง ูุชู ุฅูุบุงุคู ุชููุงุฆูุงู**
   - ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูููุช ุงูุฒููู
   - ุฑุงุฌุน ุณุฌูุงุช Cron job

2. **ุฎุทุฃ ูู ุญุณุงุจ ุงูุฃูุงู**
   - ุชุฃูุฏ ูู ุตุญุฉ `trialEndDate` ู `endDate`
   - ุชุญูู ูู Virtual properties

3. **ูุดุงูู ูู Cron job**
   - ุชุญูู ูู ุชุดุบูู ุงูุฎุงุฏู
   - ุฑุงุฌุน ุณุฌูุงุช ุงููุธุงู

### ุฃูุงูุฑ ุชุดุฎูุตูุฉ
```bash
# ูุญุต ุญุงูุฉ cron job
node -e "const cron = require('node-cron'); console.log('Cron available:', !!cron);"

# ุชุดุบูู ูุญุต ูุฏูู
curl -X POST http://localhost:5001/api/subscription/trigger-check \
  -H "Authorization: Bearer YOUR_TOKEN"

# ูุญุต ุฅุญุตุงุฆูุงุช
curl http://localhost:5001/api/subscription/stats \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ูููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู:
1. ุฑุงุฌุน ุณุฌูุงุช ุงูุฎุงุฏู
2. ุชุญูู ูู Swagger UI ููุชูุซูู ุงูุชูุงุนูู
3. ุงุณุชุฎุฏู endpoints ุงูุชุดุฎูุตูุฉ
4. ุฑุงุฌุน ููู README ูุฐุง

---

**ููุงุญุธุฉ**: ูุฐุง ุงููุธุงู ูุตูู ููููู ูุฑูุงู ููุงุจูุงู ููุชูุณุน. ูููู ุชุฎุตูุตู ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุนูู ุงููุญุฏุฏุฉ.
